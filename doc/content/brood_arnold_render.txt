---
title: uprising_arnold_render.py
description: Source code for ass export through tractor
type: Python Script
---

bc.. 
#!/usr/bin/python

"""
Wrapper to handle output of kick render for tractor.

The command and its args are passed to subprocess.Popen,
which does not block. We scan the output for interesting
stuff and handle it appropriately. In the case of progress, 
we reformat it and send it to stdout so that tractor can 
update its task progress bars.
"""

import re
import os
import sys
import subprocess

def doit(args):

    if len(args) < 1:
        sys.stdout.flush()
        print(">>> Wrong number of args to uprising_arnold_render" )
        sys.exit(2)

    p = subprocess.Popen(args,  stdout=subprocess.PIPE, stderr=subprocess.PIPE)

    progressRegEx = re.compile('.*\|\s+([\d\.]+)% done - \d+ rays/pixel')

    # Read stdout and print each new line

    sys.stdout.flush()
    for line in iter(p.stdout.readline, b''):
        sys.stdout.flush()
        stripped_line = line.strip()
        match = re.match(progressRegEx, stripped_line)
        print(">>> " + stripped_line)
        if match:
            percent = int(match.group(1)) 

            prog = 'TR_PROGRESS %d%%\n' % percent
            sys.stdout.write(prog)
            sys.stdout.flush()

if __name__ == "__main__":
    doit(sys.argv[1:])
